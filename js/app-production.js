function initializeMap(){var e={zoom:15,disableDefaultUI:!0};map=new google.maps.Map(document.getElementById("map-canvas"),e),$("#map-canvas").height($(window).height())}var PopularPlaces=function(e){this.name=ko.observable(e.venue.name),this.category=ko.observable(e.venue.categories[0].name),this.address=ko.observable(e.venue.location.formattedAddress),this.phone=ko.observable(e.venue.contact.formattedPhone),this.rating=ko.observable(e.venue.rating),this.imgSrc=ko.observable("https://irs0.4sqi.net/img/general/100x100"+e.venue.photos.groups[0].items[0].suffix)},ViewModel=function(){function e(e){var a=e.location.lat,n=e.location.lng,t=e.name,s=e.location.address+","+e.location.city+","+e.location.country,r=e.contact.formattedPhone,i=e.rating,l=e.url,p=new google.maps.Marker({map:map,position:new google.maps.LatLng(a,n),title:t});o.push(p);var g="http://maps.googleapis.com/maps/api/streetview?size=200x110&location="+s,c='<div class="venueInfowindow"><div class="venueName"><a href ="'+l+'" target="_blank" >'+t+'</a><span class="venueRating label-info badge">'+i+'<sub> /10</sub></span></div><div class="venueContact"><span class="icon-phone"></span>'+r+'</div><img class="bgimg" src="'+g+'"></div>',u=new google.maps.InfoWindow({content:c});google.maps.event.addListener(p,"click",function(){u.open(map,p)})}function a(a){for(var n in a)e(a[n])}var n=this,o=[];n.placeList=ko.observableArray([]),this.preferredLoc=ko.observable("New York, NY"),this.preferredExplore=ko.observable("pizza"),n.searchPlaces=function(){for(var e=[],t=0;t<o.length;)o[t].setMap(null),t++;o.lenght=0,n.placeList([]);var s="&near="+n.preferredLoc(),r="&query="+n.preferredExplore(),i="https://api.foursquare.com/v2/venues/explore?&client_id=TYMQXOULIRK3I4V0E5BPIDPWYPCFMNDSXMS0C0AY2P5NJOXN&client_secret= R4RUV2LSQVGVBK1SIIUEH2LYQ1FM3QC4QC0NEMVK0B2OCTIA&v=20150102&venuePhotos=1"+s+r;$.getJSON(i,function(o){var t=o.response.groups[0].items,s=o.response.suggestedBounds,r=new google.maps.LatLngBounds(new google.maps.LatLng(s.sw.lat,s.sw.lng),new google.maps.LatLng(s.ne.lat,s.ne.lng));map.fitBounds(r),map.setCenter(r.getCenter());for(var i=0;i<t.length;i++){var l=t[i];0!=l.venue.photos.groups.length&&(n.placeList.push(new PopularPlaces(l)),e.push(l.venue))}n.placeList.sort(function(e,a){return e.rating()==a.rating()?0:e.rating()>a.rating()?-1:1}),a(e)}).error(function(){$(".venu-group").html("<h4>There is problem to retrieve data</br>Please try again later</h4>"),console.log("error")})},n.searchPlaces(),n.focusMarker=function(e){var a=e.name();for(var n in o)o[n].title==a&&(google.maps.event.trigger(o[n],"click"),map.panTo(o[n].position))}},map;$(function(){initializeMap(),ko.applyBindings(new ViewModel)});